name: YW-Auto-Bot

on:
  workflow_dispatch: # 手动触发
  schedule:
    - cron: '0 */1 * * *'  # 每1小时自动运行

jobs:
  execute-bot:
    runs-on: ubuntu-latest
    # 定义多用户矩阵，max-parallel:1 确保串行执行
    strategy:
      matrix:
        # 配置需要处理的用户（与Secrets命名对应，如USER1、USER2）
        user: [USER1, USER2, USER3, USER4, USER5] # 可扩展：添加USER3、USER4等
      max-parallel: 1 # 关键：强制逐个处理用户，避免并行

    steps:
      - name: 1. 拉取代码
        uses: actions/checkout@v3

      - name: 2. 安装 Node.js 16
        uses: actions/setup-node@v3
        with:
          node-version: '16'
          cache: 'npm'

      - name: 3. 安装依赖
        run: npm install

      - name: 4. 执行脚本（当前用户：${{ matrix.user }}）
        run: node index.js
        env:
          # 动态映射当前用户的Token（根据matrix.user匹配Secrets）
          TOKEN: ${{ secrets[format('TOKEN_{0}', matrix.user)] }}
          # 可选：传递用户名到脚本，方便日志区分
          USER_NAME: ${{ matrix.user }}
